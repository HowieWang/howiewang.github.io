---
layout: post
title:  "Python攻略-字符串的编码与多个奇特前缀"
date:   2018-08-21
categories:  
- python
- python随身听
excerpt:  Python攻略-字符串的编码与多个奇特前缀
stickie: true
---

* content
 {:toc}

## 前言

在Python中，字符串的使用占有很大的比例。因为我们生活中各种文字，符号，信息的交流在程序里都是字符串的状态。

但有时候，Python里面的字符串不那么听话，经常会弹出各种错误信息，比如：

```
TypeError: a bytes-like object is required, not 'str'

或者

UnicodeDecodeError: 'utf-8' codec can't decode byte 0xb9 in position 0: invalid start byte
```

还有时候，我们还经常在代码里面见到一些带着各种奇葩前缀的字符串，比如

```
b''
u''
r''
f''
```

这些到底都怎么回事呢？下面来讨论一下。

## Python中的字符串

### 概念

概念：str是内置的字符串类型，也就是说Python里面的字符串用str这个类来表示。

作用：用来处理文本类型的数据

表示方式：单引号，双引号，三引号（都是成对的），这里面的三引号强大一些，允许跨行。放在代码里，他们分别是这个样子，这里特别特别注意两点：

- 引号是搭配的成对的。比如单对单，多对多，单对多肯定报错
- 引号嵌套时候，要使用不同引号嵌套，比如单套多，或者多套单，否则电脑就傻傻分不清楚哪些引号是一家子了。

```
In [1]: s='单引号'

In [2]: s="双引号"

In [5]: sss = """三引号"""

In [6]: sss = """三引号
   ...: 换行
   ...: 换换换行
   ...: """

In [7]: s = "这里要嵌套引号'需要不和外面的重复'"
```

### 构造函数

这里我们重点看一下str这个类的构造函数。

```
class str(object='')
class str(object=b'', encoding='utf-8', errors='strict')
```

这个类的作用很简单，就是得到一个字符串对象。表示方法有两种，第一种，直接扔进去一个我们想用的字符串就ok，第二种复杂一点，特别是两个参数很关键，包含任何一个的时候，传入的object应该为类似字节的对象（bytes-like object）。

这时候，好玩的就来了，我们来重点说说bytes-like object


## b''

刚才我们已经在构造函数见到`object=b''`，表示的就是类似字节的对象（bytes-like object），这是一类特殊的对象的统称。生成这类对象的类有：bytes，bytearray，array.array，其中bytes最常见。一般情况下，见到`b''`，把它认为是bytes类的一个对象（实例）就好，通过type查看类型，可以轻易看到。


```
In [8]: b = b'这货不是字符串了'
  File "<ipython-input-8-6dba1e17667d>", line 1
    b = b'这货不是字符串了'
       ^
SyntaxError: bytes can only contain ASCII literal characters.


In [9]: b = b'not a string any more'

In [10]: type(b)
Out[10]: bytes
```

上面的代码，我们也可以看到，b开头的bytes对象里，不能放中文，因为这里只支持ASCII编码的文字。

这时候对应刚才构造函数里面的`encoding='utf-8'`，加上这个报错的ASCII错误，我们必须讲讲编码和解码了。

## 编码和解码

编码/解码：编码是信息从一种形式或格式转换为另一种形式的过程。解码，是编码的逆过程。

### bytes和ACSII

从bytes说起。

bytes是什么？有什么用？

计算机很强大，现在已经在衣食住行各个方面发挥重要的作用，随着人工智能的时代的到来，计算机能干的事情也越来越多，越来越神奇了。但是，计算机本质上其实是吃素的，因为它只会算0和1。

0和1是什么？在计算机里表示了二进制，这是信息处理的基本单位。专业名词叫bit（比特），指的是二进制中的一位。

但是，真的算起来，0和1一位位的去使用，太费劲了，于是我们打个包来操作吧，出现了8bit为一个单位的概念，叫做Byte（字节）。这样，每字节代表8比特，1Byte = 8bits，表示起来方便多了。当然，后续还有KB，MB，GB，TB，我想你在生活中用到硬盘，u盘的时候都知道了。

0和1计算机天生就认识了，那其他数字怎么办？各种字母，符号怎么办？

于是出现了ACSII:American Standard Code for Information Interchange，美国信息交换标准代码，这是基于拉丁字母的一套计算机编码系统。主要用于26个基本拉丁字母、阿拉伯数目字和英式标点符号。这里其实就是给各个字母和符号起了一个数字的名字，然后一一对应起来，电脑见到数字就知道是哪个字母或符号了。


```
二进制	十进制	十六进制	图形
0010 0000	32	20	(space)
0010 0001	33	21	!
0010 0010	34	22	"
0010 0011	35	23	#
0010 0100	36	24	$
0010 0101	37	25	%
0010 0110	38	26	&
0010 0111	39	27	'
0010 1000	40	28	(
0010 1001	41	29	)
0010 1010	42	2A	*
0010 1011	43	2B	+
0010 1100	44	2C	,
0010 1101	45	2D	-
0010 1110	46	2E	.
0010 1111	47	2F	/
0011 0000	48	30	0
0011 0001	49	31	1
0011 0010	50	32	2
0011 0011	51	33	3
0011 0100	52	34	4
0011 0101	53	35	5
0011 0110	54	36	6
0011 0111	55	37	7
0011 1000	56	38	8
0011 1001	57	39	9
0011 1010	58	3A	:
0011 1011	59	3B	;
0011 1100	60	3C	<
0011 1101	61	3D	=
0011 1110	62	3E	>
0011 1111	63	3F	?
二进制	十进制	十六进制	图形
0100 0000	64	40	@
0100 0001	65	41	A
0100 0010	66	42	B
0100 0011	67	43	C
0100 0100	68	44	D
0100 0101	69	45	E
0100 0110	70	46	F
0100 0111	71	47	G
0100 1000	72	48	H
0100 1001	73	49	I
0100 1010	74	4A	J
0100 1011	75	4B	K
0100 1100	76	4C	L
0100 1101	77	4D	M
0100 1110	78	4E	N
0100 1111	79	4F	O
0101 0000	80	50	P
0101 0001	81	51	Q
0101 0010	82	52	R
0101 0011	83	53	S
0101 0100	84	54	T
0101 0101	85	55	U
0101 0110	86	56	V
0101 0111	87	57	W
0101 1000	88	58	X
0101 1001	89	59	Y
0101 1010	90	5A	Z
0101 1011	91	5B	[
0101 1100	92	5C	\
0101 1101	93	5D	]
0101 1110	94	5E	^
0101 1111	95	5F	_
二进制	十进制	十六进制	图形
0110 0000	96	60	`
0110 0001	97	61	a
0110 0010	98	62	b
0110 0011	99	63	c
0110 0100	100	64	d
0110 0101	101	65	e
0110 0110	102	66	f
0110 0111	103	67	g
0110 1000	104	68	h
0110 1001	105	69	i
0110 1010	106	6A	j
0110 1011	107	6B	k
0110 1100	108	6C	l
0110 1101	109	6D	m
0110 1110	110	6E	n
0110 1111	111	6F	o
0111 0000	112	70	p
0111 0001	113	71	q
0111 0010	114	72	r
0111 0011	115	73	s
0111 0100	116	74	t
0111 0101	117	75	u
0111 0110	118	76	v
0111 0111	119	77	w
0111 1000	120	78	x
0111 1001	121	79	y
0111 1010	122	7A	z
0111 1011	123	7B	{
0111 1100	124	7C	|
0111 1101	125	7D	}
0111 1110	126	7E	~
```


这里的十进制和十六进制都是为了更容易理解和快捷表示而进行的转换。

在Python里面，我们可以通过几个内置的函数，很容易完成这些转换。我们随便举几个例子，比如‘D’，‘8’，‘g’。

相应的函数为：

- bin()：转成二进制字符串
- hex()：转成十六进制字符串
- int()：把字符串转为整数，第二个参数控制多少进制，比如2，16

```

```


